# go-swagger-httptest
POC: go-swagger server example impl that using httptest

## Abstract

Using httptest with server code generated by go-swagger does not support officially.

https://github.com/go-swagger/go-swagger/issues/719

So it might be Dirty Hack, but I tried using httptest.

see `hello_test.go`

## How to use go-swagger serverside with httptest

Add exposed function that return http.Handler in configure_${your-project}.go

```go:restpi.configure_hello.go
func ConfigureAPI(api *hello.HelloAPI) http.Handler {
	return configureAPI(api)
}
```

You create handler code in your test.

```go hello_test.go
func HelloHandler() (http.Handler, error) {
	swaggerSpec, err := loads.Embedded(restapi.SwaggerJSON, restapi.FlatSwaggerJSON)
	if err != nil {
		return nil, err
	}

	api := hello.NewHelloAPI(swaggerSpec)
	h := restapi.ConfigureAPI(api)

	return h, nil
}

func TestHello(t *testing.T) {

	h, err := HelloHandler()
	if err != nil {
		t.Fatal("api handler", err)
	}

    ts := httptest.NewServer(h)
    defer ts.Close()

    // httptest request
    resp, err := http.Get(ts.URL + "/v1/hello")
}
```

## Memo

generate `gen` directory.

```sh
go get -u github.com/go-swagger/go-swagger@0.25.0
swagger generate server -a hello -A hello --strict-additional-properties -t gen
```
